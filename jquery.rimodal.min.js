/*! RiModal - A flexible and good looking modal window plugin for jQuery
* https://github.com/kensnyder/jQuery-RiModal
* Copyright (c) 2015 Ken Snyder; Licensed MIT */
!function(i,t,e,o){function n(){this.initialize.apply(this,[].slice.call(arguments))}function a(i,t){var e;return function(){clearTimeout(e),e=setTimeout(t,i)}}n.defaultOptions={title:"",width:400,height:300,animation_duration:400,draggable:!1,drag_handle:".ri-modal-title",ghost_while_dragging:!0,cover:!0,cover_closes:!0,ease_open:"riEaseOutQuart",ease_close:"riEaseInQuart",destroy_on_close:!0,ajax:!1,iframe:!1,element:!1,text:!1,ajax_query_suffix:"",position:"center-middle",offset:{x:0,y:0},iframe_query_suffix:"hexmodal=1",html:{cover:'<div class="ri-modal-cover"></div>',dialog:'<div class="ri-modal-dialog"><div class="ri-modal-inner"><div class="ri-modal-header"><h1 class="ri-modal-title"></h1><a class="ri-modal-close"><span>&times;</span></a></div><div class="ri-modal-content"></div></div></div>',message:'<div class="ri-modal-message"><div class="ri-modal-content"></div></div>'}},n.nextZIndex=1001,n.activeModals=[],n.closeTop=function(){var i=this.get("top");i&&i.close()},n.get=function(i){if("self"==i){var e;if(t.parent&&t.parent.jQuery&&t.jQuery.RiModal){if(e=t.parent.jQuery.RiModal.get("top"),e&&"iframe"==e.getContentType())return e}else if(e=n.get("top"),e&&"iframe"==!e.getContentType())return e}else"bottom"==i?i=0:("top"==i||0===arguments.length)&&(i=n.activeModals.length-1);return n.activeModals[i]},n.closeAll=function(){for(;n.activeModals.length;)n.closeTop()},n.showMessage=function(e,o){o=i.extend({text:e||"Loading...",html:{cover:n.defaultOptions.html.cover,dialog:n.defaultOptions.html.message},origin:!1,width:500,height:"auto",draggable:!1,cover_closes:!1},o||{});var a=new n(o);return o.reload===!0&&a.one("Opened",function(){t.location.reload()}),o.redirect&&a.one("Opened",function(){t.location.href=o.redirect}),a.open(),a},n._removeFromActiveList=function(i){for(var t,e=[],o=0;t=n.activeModals[o++];)t!==i&&e.push(t);n.activeModals=e},n.prototype={initialize:function(t){var e=this;e.options=i.extend(!0,{},n.defaultOptions,t||{}),e.id=g++,e._setupEvents(),e.publish("Init"),e.options.origin&&e.setOrigin(e.options.origin)},_setupEvents:function(){var i=this;i._setupPubsub(),i._attachStateListeners();for(var t in i.options)t.match(/^on[A-Z0-9]/)&&"function"==typeof i.options[t]&&i.on(t.slice(2),i.options[t])},_attachStateListeners:function(){var i=this;i.isLoading=!1,i.isLoaded=!1,i.isOpening=!1,i.isOpened=!1,i.isClosing=!1,i.wasDragged=!1,i.isDragging=!1,i.isResizing=!1,i.on("Loading",function(){i.isLoaded=!1,i.isLoading=!0}),i.on("Loaded",function(){i.isLoaded=!0,i.isLoading=!1}),i.on("Opening",function(){i.isOpened=!1,i.isOpening=!0}),i.on("Opened",function(){i.isOpened=!0,i.isOpening=!1}),i.on("Closing",function(){i.isClosing=!0}),i.on("Closed",function(){i.isClosing=!1,i.isOpened=!1}),i.one("Dragging",function(){i.isDragging=!0}),i.one("Dragged",function(){i.isDragging=!1}),i.one("Dragged",function(){i.wasDragged=!0}),i.on("Resizing",function(){i.isResizing=!0}),i.on("Resized",function(){i.isResizing=!1})},_setupPubsub:function(){var t=this;t.pubsub=i(t),t.on=i.proxy(t.pubsub,"on"),t.off=i.proxy(t.pubsub,"off"),t.one=i.proxy(t.pubsub,"one"),t.trigger=i.proxy(t.pubsub,"trigger"),t.triggerHandler=i.proxy(t.pubsub,"triggerHandler")},publish:function(t,e){var o=this,n=i.Event(t);return n.target=o,e&&i.extend(n,e),o.trigger(n),n},showLoader:function(){var i=this;return i.$dialog.addClass("ri-modal-loading"),i},hideLoader:function(){var i=this;return i.$dialog.removeClass("ri-modal-loading"),i},open:function(){var t=this,e=t.publish("Opening");if(e.isDefaultPrevented())return void(t.isOpening=!1);n.activeModals.push(t),t.options.cover&&(d.css("overflow-x","hidden"),d.css("overflow-y","hidden"));var o=t.calcSize();t.renderCover(o),t.renderDialog(o);var r="";return"title"in t.options?r="function"==typeof t.options.title?t.options.title.call(this):String(t.options.title):this.origin&&this.origin.tagName&&this.origin.tagName.match(/^(a|button)$/i)?r=this.$origin.text():this.origin&&"INPUT"==this.origin.tagName&&this.origin.type&&this.origin.type.match(/^(submit|button)$/i)&&(r=this.$origin.val()),r=i.trim(r),r&&t.setTitle(r),s.on("resize.rimodal"+t.id,a(25,i.proxy(t,"resize"))),t.one("Opened",function(){t.isLoaded||(t.showLoader(),t.one("Loaded",function(){t.hideLoader()})),t.options.draggable&&t.enableDragging()}),t.isLoading||t.isLoaded||t.load(),t},getContentSpecs:function(){var t=this,e={};return i.each(["element","text","ajax","iframe"],function(){var i=typeof t.options[this];"function"==i?e[this]=t.options[this].call(t,t.origin):"object"==i&&t.options[this].attribute&&t.origin&&t.origin.tagName?e[this]=t.origin.getAttribute(t.options[this].attribute):"undefined"!=i&&(e[this]=t.options[this])}),e.element||e.text||e.ajax||e.iframe||(e.iframe=t.origin.getAttribute("href")),e},getContentType:function(){return this.type},load:function(){var t,o=this;o.$content.removeClass("ri-modal-element ri-modal-text ri-modal-html ri-modal-ajax ri-modal-iframe ri-modal-empty");var n=o.publish("Loading");if(n.isDefaultPrevented())return this.isLoading=!1,o;var a=o.getContentSpecs();if(a.element)o.type="element","string"==typeof a.element&&(a.element=i(a.element)),o.$content.addClass("ri-modal-element").append(a.element),o.handleAutoSizing(),o.publish("Loaded");else if(a.text)o.type="text",o.$content.addClass("ri-modal-text").text(a.text),o.publish("Loaded");else if("object"==typeof a.ajax)o.type="ajax",o.$content.addClass("ri-modal-ajax"),a.ajax.url&&(a.ajax.url+=(a.ajax.url.match(/\?/)?"&":"?")+o.options.ajax_query_suffix),i.ajax(a.ajax).done(function(i){o.$content.html(i),o.handleAutoSizing()}).always(function(){o.publish("Loaded")});else if("string"==typeof a.ajax)o.type="ajax",t=a.ajax+(a.ajax.match(/\?/)?"&":"?")+o.options.ajax_query_suffix,o.$content.addClass("ri-modal-ajax").load(t,function(){o.handleAutoSizing(),o.publish("Loaded")});else if(a.iframe){o.type="iframe",t=a.iframe+(a.iframe.match(/\?/)?"&":"?")+o.options.iframe_query_suffix;var s=i(e.createElement("iframe")).attr({frameborder:"0",width:"100%",height:"100%",src:t}).on("load",function(){o.publish("Loaded")});o.$content.addClass("ri-modal-iframe").append(s)}else o.$content.addClass("ri-modal-empty"),o.publish("Loaded");return o},enableDragging:function(){var i=this;if(!i.isDraggable){i.isDraggable=!0,i.$dialog.addClass("ri-modal-draggable");var t,e=i.$dialog.find(i.options.drag_handle),o=function(e){var o=i.publish("Dragging",{mousedown:e});if(o.isDefaultPrevented())return void(i.isDragging=!1);var s=i.$dialog.offset();t={left:e.pageX-s.left,top:e.pageY-s.top},r.on("mousemove",a),r.on("mouseup",n),i.options.ghost_while_dragging&&i.$content.css("opacity",0)},n=function(t){r.unbind("mousemove",a),r.unbind("mouseup",n),i.options.ghost_while_dragging&&i.$content.css("opacity",1),i.publish("Dragged",{mouseup:t})},a=function(e){var o={left:e.pageX-t.left,top:Math.max(-18,e.pageY-t.top)};i.publish("Moving",{mousemove:e,newPosition:o}),i.$dialog.offset(o)};return e.on("mousedown.draggable",o),i}},disableDragging:function(){var i=this;if(i.isDraggable){i.isDraggable=!1,i.$dialog.removeClass("ri-modal-draggable");var t=i.$dialog.find(i.options.drag_handle);return t.off("mousedown.draggable"),i.$content.show(),i}},renderCover:function(t){var o=this;if(o.options.cover){var a=o.calcOverflow(),s=i("body");a.hasScrollbarX&&(s.css("overflow-x","scroll"),o.one("Closed",function(){s.css("overflow-x","")})),a.hasScrollbarY&&(s.css("overflow-y","scroll"),o.one("Closed",function(){s.css("overflow-y","")})),o.$cover=i(o.options.html.cover).css({position:"absolute",top:t.scrollTop+"px",left:"0",width:t.viewportWidth+"px",height:t.viewportHeight+"px",opacity:"0.001",zIndex:n.nextZIndex++}).appendTo(e.body).animate({opacity:"1"},o.options.animation_duration/2),o.options.cover_closes&&o.$cover.on("click",i.proxy(o,"close"))}else o.$cover=i();return o},renderDialog:function(t){var o=this;return o.$dialog=i(o.options.html.dialog).css({position:"absolute",top:t.originTop+"px",left:t.originLeft+"px",width:t.originWidth+"px",height:t.originHeight+"px",opacity:"0",zIndex:n.nextZIndex++}),o.publish("Rendered"),o.$dialog.appendTo(e.body).animate({top:t.top+"px",left:t.left+"px",width:t.width+"px",height:t.height+34+"px",opacity:"1"},o.options.animation_duration,o.options.ease_close,function(){o.publish("Opened")}),o.$close=o.$dialog.find(".ri-modal-close").on("click",i.proxy(o,"close")),o.$content=o.$dialog.find(".ri-modal-content").css({width:t.width+"px",height:t.height+"px"}),o},resize:function(i,t){var e=this;2==arguments.length&&(e.options.width=i,e.options.height=t);var o=e.calcSize(),n=e.publish("Resizing",{size:o});return n.isDefaultPrevented()?(e.isResizing=!1,e):(e.$cover.css({top:o.scrollTop+"px",width:o.viewportWidth+"px",height:o.viewportHeight+"px"}),e.options.draggable&&e.wasDragged?e.publish("Resized",{size:o}):(e.$dialog.animate({top:o.top+"px",left:o.left+"px",width:o.width+"px",height:o.height+34+"px"},e.options.animation_duration/2,e.options.ease_open,function(){e.publish("Resized",{size:o})}),e.$content.animate({width:o.width+"px",height:o.height+"px"},e.options.animation_duration/2,e.options.ease_open)),e)},handleAutoSizing:function(){var i=this;if("auto"!=i.options.height)return i;var t=i.$dialog.height(),e=i.$content.height();return i.$dialog.css("height",""),i.$content.css("height",""),i.options.height=i.$content.height()+40,i.$dialog.css("height",t),i.$content.css("height",e),i.resize(),i},calcOverflow:function(){var i={};return i.x=d.css("overflow-x"),i.y=d.css("overflow-y"),i.hasScrollbarX="scroll"==i.x||"auto"==i.x&&l.scrollWidth>l.clientWidth,i.hasScrollbarY="scroll"==i.y||"auto"==i.y&&l.scrollHeight>l.clientHeight,i},calcSize:function(){var i,e=this,n={};return n.viewportWidth=s.width(),n.viewportHeight=s.height(),n.scrollTop=t.pageYOffset||l.scrollTop,n.maxHeight=n.viewportHeight-48-34,n.maxWidth=n.viewportWidth-48,"full"==e.options.width?(n.width=n.maxWidth,n.left=12+n.scrollTop):(n.width=Math.min(parseFloat(e.options.width),n.maxWidth),n.left=e.options.left==o?Math.max(5,Math.floor((n.viewportWidth-n.width-30)/2)):e.options.left),"full"==e.options.height?(n.height=n.maxHeight,n.top=12+n.scrollTop):"auto"==e.options.height?(n.height=Math.floor(n.maxHeight/2),n.top=(e.options.top==o?Math.max(5,Math.floor((n.viewportHeight-n.height-60)/2)):e.options.top)+n.scrollTop):(n.height=Math.min(parseFloat(e.options.height),n.maxHeight),n.top=(e.options.top==o?Math.max(5,Math.floor((n.viewportHeight-n.height-60)/2)):e.options.top)+n.scrollTop),e.$origin&&(i=e.$origin.offset()),i?(n.originWidth=e.$origin.outerWidth(),n.originHeight=e.$origin.outerHeight(),n.originTop=i.top,n.originLeft=i.left):(n.originWidth=40,n.originHeight=40,n.originTop=Math.floor(n.viewportHeight/2-n.originHeight)+n.scrollTop,n.originLeft=Math.floor(n.viewportWidth/2-n.originWidth)),this.handlePositionOption(n),n.timestamp=+new Date,e.publish("Calculated",{size:n}),n},setOrigin:function(t){var e=this;return e.$origin=i(t),e.origin=e.$origin.get(0),e},close:function(){var i=this,t=i.publish("Closing");if(t.isDefaultPrevented())return i.isClosing=!1,i;s.off("resize.rimodal"+i.id);var e=i.calcSize();return i.$dialog.stop().animate({top:e.originTop+"px",left:e.originLeft+"px",width:e.originWidth+"px",height:e.originHeight+"px",opacity:"0"},i.options.animation_duration,i.options.ease_close,function(){0===i.$cover.length&&(i.publish("Closed"),i.options.destroy_on_close&&i.destroy())}),i.$cover.stop().animate({opacity:"0"},1.5*i.options.animation_duration,i.options.ease_close,function(){d.css("overflow-x",""),d.css("overflow-y",""),i.publish("Closed"),i.options.destroy_on_close&&i.destroy()}),n._removeFromActiveList(i),i},destroy:function(){var i=this,t=i.publish("Destroying");return t.isDefaultPrevented()?i:(i.$content=o,i.$cover.empty().remove(),i.$dialog.empty().remove(),i.$cover=o,i.$dialog=o,i.publish("Destroyed"),i)},hide:function(){var i=this;return i.$dialog&&i.$dialog.hide(),i.$cover&&i.$cover.hide(),i},show:function(){var i=this;return i.$dialog&&i.$dialog.show(),i.$cover&&i.$cover.show(),i},setTitle:function(i){var t=this;return t.$dialog.find(".ri-modal-title").text(i),t},handlePositionOption:function(i){this.options.position.toLowerCase().split("-").forEach(function(t){"left"==t?i.left=12:"center"==t||("right"==t?i.left=i.viewportWidth-40-i.width:"top"==t?i.top=12:"middle"==t||"bottom"==t&&(i.top=i.viewportHeight-72-i.height))}),i.left+=this.options.offset.x||0,i.top+=this.options.offset.y||0}},i.RiModal=n,i.fn.riModal=function(t){t=t||{};var e=function(e){e.preventDefault();var o,a={};for(var s in n.defaultOptions)n.defaultOptions.hasOwnProperty(s)&&(o="data-modal-"+s.replace(/_/g,"-"),this.hasAttribute(o)&&(a[s]=this.getAttribute(o)));var r=new n(i.extend(a,{origin:this},t));r.open()};return t.delegate?this.on(t.event||"click",t.delegate,e):this.on(t.event||"click",e)},i.easing.riEaseInQuart=function(i,t,e,o,n){return o*(t/=n)*t*t*t+e},i.easing.riEaseOutQuart=function(i,t,e,o,n){return-o*((t=t/n-1)*t*t*t-1)+e};var s=i(t),r=i(e),l=e.documentElement,d=i(l),g=1}(jQuery,window,document);